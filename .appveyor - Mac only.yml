version: '2.4.5.{build}'

# Do not build on tags (GitHub only)
skip_tags: true
clone_depth: 1

image:
  - macos

branches:
  only:
    - master     
        

#environment:
#  GITHUB_TOKEN:
#    secure: 9UB76Z8mCWYt1u7Ci2fPVNiI3iK3LzTuIPhtNGBbxKP7YOPaUuq2yHxRjIfRPEAx
#  UPLOADTOOL_BODY:
#    "WARNING: pre-release builds may not work. Use at your own risk.”



environment:
  ARTISAN_OS: osx
  PYTHON: ~/venv3.8
  language: generic
  HOMEBREW_NO_INSTALL_CLEANUP: 1
  HOMEBREW_NO_ANALYTICS: 1
  MACOSX_DEPLOYMENT_TARGET: 10.15

install:
  - export GIT_VERSION=`git rev-parse --verify --short HEAD 2>/dev/null|| echo "???"`
  - sed -i'' -e "s/__revision__ = '0'/__revision__ = '$GIT_VERSION'/" src/artisanlib/__init__.py
#   don't know why the shell files lost execution permission when shifting to the new-builds repo
  - chmod 777 ./.ci/*.sh
  - .ci/install-${ARTISAN_OS}.sh

build_script:
#   don't know why the shell files lost execution permission when shifting to the new-builds repo
  - chmod 777 src/*.sh
  - .ci/script-${ARTISAN_OS}.sh
#  - ls -l src/artisan*
  
artifacts:
  - path: 'src/artisan-*.dmg'

#deploy_script:
#  - cd src
#  - cmd: curl -L -O https://github.com/rpaulo/uploadtool/raw/master/upload.sh
#  - export UPLOADTOOL_BODY="WARNING pre-release builds may not work. Use at your own risk."
#  - export UPLOADTOOL_ISPRERELEASE=true
#  - cmd: bash upload.sh artisan-*.dmg
